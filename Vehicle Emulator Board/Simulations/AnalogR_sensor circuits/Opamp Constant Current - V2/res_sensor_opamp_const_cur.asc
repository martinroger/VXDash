Version 4
SHEET 1 1028 756
WIRE 448 -48 448 -80
WIRE 16 32 16 0
WIRE 448 64 448 32
WIRE 448 64 208 64
WIRE -352 80 -352 48
WIRE 272 112 272 96
WIRE 208 128 208 64
WIRE 240 128 208 128
WIRE 448 128 448 64
WIRE 400 144 304 144
WIRE 16 160 16 112
WIRE 48 160 16 160
WIRE 240 160 48 160
WIRE -352 192 -352 160
WIRE 16 192 16 160
WIRE 272 192 272 176
WIRE 16 304 16 272
WIRE 448 320 448 224
WIRE 752 320 448 320
WIRE 448 352 448 320
WIRE 448 368 448 352
WIRE 752 480 752 320
WIRE 880 480 752 480
WIRE 752 496 752 480
WIRE 448 512 448 432
WIRE 448 560 448 512
WIRE -352 624 -352 592
WIRE 448 656 448 640
WIRE 752 656 752 576
WIRE 752 656 448 656
WIRE 448 672 448 656
WIRE -352 736 -352 704
FLAG -352 48 5V
FLAG -352 192 0
FLAG 16 0 5V
FLAG 16 304 0
FLAG 48 160 Vref
FLAG 272 96 Vs
FLAG 272 192 0
FLAG 448 672 0
FLAG 448 -80 5V
FLAG 448 64 Vset
FLAG 448 352 Vsense
FLAG 880 480 Vgpio
FLAG 448 512 Vload
FLAG -352 592 Vs
FLAG -352 736 0
SYMBOL voltage -352 64 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=10m
SYMATTR InstName 5V
SYMATTR Value 5
SYMBOL res 0 16 R0
SYMATTR InstName R2
SYMATTR Value 180k
SYMBOL res 0 176 R0
SYMATTR InstName R3
SYMATTR Value 330k
SYMBOL res 432 544 R0
SYMATTR InstName R1
SYMATTR Value {Rsense}
SYMBOL res 432 -64 R0
SYMATTR InstName Rset
SYMATTR Value 430
SYMBOL lm358 272 80 R0
SYMATTR InstName U2
SYMBOL schottky 432 368 R0
SYMATTR InstName D1
SYMATTR Value PMEG3010BEA
SYMBOL voltage -352 608 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=10m
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL pmos 400 224 M180
SYMATTR InstName M1
SYMATTR Value BSS84
TEXT -280 120 Left 2 ;Set Vref to 3.23
TEXT -256 392 Left 2 !.op
TEXT 32 416 Left 2 !.step param Rsense 5 1000 5
TEXT -280 664 Left 2 ;Provide more than V+ + 2V (Common mode voltage)!
