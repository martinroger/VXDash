Version 4
SHEET 1 1164 1540
WIRE 448 -400 448 -432
WIRE 656 -400 448 -400
WIRE 448 -368 448 -400
WIRE 656 -320 656 -400
WIRE -208 -288 -208 -336
WIRE 288 -272 240 -272
WIRE 400 -272 368 -272
WIRE -208 -176 -208 -208
WIRE 448 -144 448 -192
WIRE 656 -144 656 -240
WIRE 656 -144 448 -144
WIRE 16 32 16 0
WIRE 448 64 448 -144
WIRE 448 64 208 64
WIRE -224 96 -224 64
WIRE 272 112 272 96
WIRE 208 128 208 64
WIRE 240 128 208 128
WIRE 448 128 448 64
WIRE 400 144 304 144
WIRE 16 160 16 112
WIRE 48 160 16 160
WIRE 240 160 48 160
WIRE 16 192 16 160
WIRE 272 192 272 176
WIRE -224 208 -224 176
WIRE 448 288 448 224
WIRE 832 288 448 288
WIRE 16 304 16 272
WIRE 832 304 832 288
WIRE 448 320 448 288
WIRE 448 368 448 320
WIRE 832 480 832 384
WIRE 1040 480 832 480
WIRE 448 512 448 432
WIRE 448 560 448 512
WIRE 832 576 832 480
WIRE 448 656 448 640
WIRE 832 656 448 656
WIRE 448 672 448 656
WIRE 448 800 448 768
WIRE 16 880 16 848
WIRE 448 912 448 880
WIRE 448 912 208 912
WIRE 272 960 272 944
WIRE 208 976 208 912
WIRE 240 976 208 976
WIRE 448 976 448 912
WIRE 400 992 304 992
WIRE 16 1008 16 960
WIRE 240 1008 16 1008
WIRE 16 1040 16 1008
WIRE 272 1040 272 1024
WIRE 448 1136 448 1072
WIRE 832 1136 448 1136
WIRE 16 1152 16 1120
WIRE 832 1152 832 1136
WIRE 448 1216 448 1136
WIRE 832 1328 832 1232
WIRE 1040 1328 832 1328
WIRE 448 1360 448 1280
WIRE 448 1408 448 1360
WIRE 832 1424 832 1328
WIRE 448 1504 448 1488
WIRE 832 1504 448 1504
WIRE 448 1520 448 1504
FLAG 16 0 Vs
FLAG 16 304 0
FLAG 48 160 Vref
FLAG 272 96 Vs
FLAG 272 192 0
FLAG 448 672 0
FLAG 448 -432 Vs
FLAG 448 64 Vset
FLAG 448 320 VsenseR
FLAG 448 512 VloadR
FLAG -224 64 Vs
FLAG -224 208 0
FLAG 16 848 Vs
FLAG 16 1152 0
FLAG 272 944 Vs
FLAG 272 1040 0
FLAG 448 1520 0
FLAG 448 768 Vs
FLAG 448 1136 VsenseKR
FLAG 448 1360 VloadKR
FLAG 1040 480 VGPIOR
FLAG 1040 1328 VGPIOkR
FLAG -208 -176 0
FLAG -208 -336 Vselect
FLAG 240 -272 Vselect
SYMBOL res 0 16 R0
SYMATTR InstName R2
SYMATTR Value 6k8
SYMATTR SpiceLine tol=1
SYMBOL res 0 176 R0
SYMATTR InstName R3
SYMATTR Value 330k
SYMATTR SpiceLine tol=1
SYMBOL res 432 544 R0
SYMATTR InstName R1
SYMATTR Value {Rsense}
SYMATTR SpiceLine tol=1
SYMBOL res 432 -384 R0
SYMATTR InstName RsetLowR
SYMATTR Value 39
SYMATTR SpiceLine tol=1
SYMBOL schottky 432 368 R0
SYMATTR InstName D1
SYMATTR Value PMEG3010BEA
SYMBOL voltage -224 80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 124 Left 2
SYMATTR SpiceLine Rser=10m
SYMATTR InstName V1
SYMATTR Value 5
SYMBOL pmos 400 224 M180
SYMATTR InstName M1
SYMATTR Value BSS84
SYMBOL OpAmps\\AD8542 272 80 R0
SYMATTR InstName U1
SYMBOL res 0 864 R0
SYMATTR InstName R4
SYMATTR Value 6k8
SYMATTR SpiceLine tol=1
SYMBOL res 0 1024 R0
SYMATTR InstName R5
SYMATTR Value 330k
SYMATTR SpiceLine tol=1
SYMBOL res 432 1392 R0
SYMATTR InstName R6
SYMATTR Value {Rsense}
SYMATTR SpiceLine tol=1
SYMBOL res 432 784 R0
SYMATTR InstName RsetHighR
SYMATTR Value 22
SYMATTR SpiceLine tol=1
SYMBOL schottky 432 1216 R0
SYMATTR InstName D2
SYMATTR Value PMEG3010BEA
SYMBOL pmos 400 1072 M180
SYMATTR InstName M2
SYMATTR Value BSS84
SYMBOL OpAmps\\AD8542 272 928 R0
SYMATTR InstName U2
SYMBOL res 816 288 R0
SYMATTR InstName R7
SYMATTR Value 54000
SYMATTR SpiceLine tol=1
SYMBOL res 816 560 R0
SYMATTR InstName R8
SYMATTR Value 102000
SYMATTR SpiceLine tol=1
SYMBOL res 816 1136 R0
SYMATTR InstName R9
SYMATTR Value 54000
SYMATTR SpiceLine tol=1
SYMBOL res 816 1408 R0
SYMATTR InstName R10
SYMATTR Value 102000
SYMATTR SpiceLine tol=1
SYMBOL pmos 400 -192 M180
SYMATTR InstName M3
SYMATTR Value BSS84
SYMBOL res 384 -288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL res 640 -336 R0
SYMATTR InstName RsetHighR1
SYMATTR Value 51
SYMATTR SpiceLine tol=1
SYMBOL voltage -208 -304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 22 116 Left 2
SYMATTR InstName V2
SYMATTR Value 0
SYMATTR SpiceLine Rser=10m
TEXT 32 416 Left 2 !.step param Rsense 1 5001 25
TEXT 40 512 Left 2 !.op
