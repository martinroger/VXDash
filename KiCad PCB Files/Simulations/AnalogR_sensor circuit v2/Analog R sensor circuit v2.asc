Version 4
SHEET 1 2696 712
WIRE 592 -368 592 -432
WIRE 592 -368 480 -368
WIRE 704 -368 592 -368
WIRE 480 -336 480 -368
WIRE 704 -336 704 -368
WIRE 1184 -224 1184 -256
WIRE 1296 -224 1184 -224
WIRE 480 -208 480 -256
WIRE 704 -208 704 -256
WIRE 256 -192 128 -192
WIRE 432 -192 336 -192
WIRE 992 -176 992 -256
WIRE 1184 -176 1184 -224
WIRE 1296 -160 1296 -224
WIRE 1184 -48 1184 -96
WIRE 1296 -48 1296 -96
WIRE 1296 -48 1184 -48
WIRE 992 -32 992 -96
WIRE 1184 -32 1184 -48
WIRE 480 0 480 -112
WIRE 560 0 480 0
WIRE 704 0 704 -128
WIRE 704 0 560 0
WIRE -128 80 -128 16
WIRE 560 96 560 0
WIRE 560 96 80 96
WIRE 208 128 208 64
WIRE 304 128 208 128
WIRE -208 176 -224 176
WIRE -128 176 -128 160
WIRE -128 176 -208 176
WIRE 16 176 -128 176
WIRE 80 176 80 96
WIRE 144 176 80 176
WIRE 208 176 208 128
WIRE -208 192 -208 176
WIRE -128 192 -128 176
WIRE 560 192 560 96
WIRE 352 208 272 208
WIRE 512 208 432 208
WIRE 16 240 16 176
WIRE 144 240 16 240
WIRE -208 288 -208 256
WIRE -128 288 -128 272
WIRE -128 288 -208 288
WIRE 688 288 560 288
WIRE -128 304 -128 288
WIRE 208 304 208 240
WIRE 304 304 304 192
WIRE 304 304 208 304
WIRE 560 320 560 288
WIRE 912 320 912 272
WIRE 208 336 208 304
WIRE 560 448 560 384
WIRE 560 448 448 448
WIRE 688 448 560 448
WIRE 912 448 912 384
WIRE 912 448 768 448
WIRE 1056 448 912 448
WIRE 912 512 912 448
WIRE 560 528 560 448
WIRE 912 608 912 576
WIRE 560 640 560 608
FLAG -128 304 0
FLAG -128 16 Vsupply
FLAG 592 -432 Vsupply
FLAG 912 272 Vsupply
FLAG 1056 448 VADC
FLAG 560 640 0
FLAG 128 -192 setHigh
FLAG 208 64 Vsupply
FLAG 208 336 0
FLAG 992 -32 0
FLAG 992 -256 setHigh
FLAG 1184 -256 Vsupply
FLAG 1184 -32 0
FLAG -224 176 Vref
FLAG 448 448 Vsense
FLAG 688 288 D1_A
FLAG 912 608 0
SYMBOL AS2333 208 208 R0
SYMATTR InstName U1
SYMBOL pmos 512 288 M180
SYMATTR InstName M1
SYMATTR Value DMP3099L
SYMATTR Prefix X
SYMBOL res -144 176 R0
SYMATTR InstName R1
SYMATTR Value 820k
SYMBOL res -144 64 R0
SYMATTR InstName R2
SYMATTR Value 39k
SYMBOL res 448 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL pmos 432 -112 M180
SYMATTR InstName M2
SYMATTR Value DMP3099L
SYMATTR Prefix X
SYMBOL res 464 -352 R0
SYMATTR InstName R5
SYMATTR Value 18
SYMBOL res 688 -352 R0
SYMATTR InstName R6
SYMATTR Value 160
SYMBOL res 688 -224 R0
SYMATTR InstName R7
SYMATTR Value 6R8
SYMBOL res 352 -208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL schottky 544 320 R0
SYMATTR InstName D1
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky 928 384 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value BAT54
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 784 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL res 544 512 R0
SYMATTR InstName R10
SYMATTR Value {Rsense}
SYMBOL voltage 992 -192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value {VsetHigh}
SYMBOL voltage 1184 -192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 3.3
SYMBOL cap -224 192 R0
SYMATTR InstName C1
SYMATTR Value 100n
SYMATTR SpiceLine V=50
SYMBOL cap 1280 -160 R0
SYMATTR InstName C2
SYMATTR Value 100n
SYMATTR SpiceLine V=50
SYMBOL cap 288 128 R0
SYMATTR InstName C3
SYMATTR Value 100n
SYMATTR SpiceLine V=50
SYMBOL cap 896 512 R0
SYMATTR InstName C4
SYMATTR Value 33n
SYMATTR SpiceLine V=50
TEXT 0 504 Left 2 !.LIB DMP3099L.spice.txt
TEXT -104 -288 Left 2 !.param VsetHigh=3.3*buf(Rsense/(2*300))
TEXT -256 696 Left 2 !.step param Rsense 15 900 15
TEXT 832 80 Left 2 ;.tran 0 5 0.5 0.1
TEXT -256 648 Left 2 ;.param Rsense=120
TEXT 840 112 Left 2 !.op
